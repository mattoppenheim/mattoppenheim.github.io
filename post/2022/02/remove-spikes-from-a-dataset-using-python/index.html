<!doctype html><html><head><meta charset=utf-8><title>Remove spikes from a dataset using python - mattoppenheim</title><meta name=pinterest content="nopin"><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><link rel="dns-prefetch preconnect" href=https://fonts.gstatic.com crossorigin><link rel="dns-prefetch preconnect" href=https://use.fontawesome.com crossorigin><meta name=theme-color content="#263238"><meta name=generator content="Hugo 0.105.0"><link rel=apple-touch-icon href=https://mattoppenheim.github.ioimages/logo.png><meta name=description content="Problem How to remove random spikes from data.
Summary Using the pandas library in python we can remove random spikes from data. For this blog, I create a sine wave with random spikes then show the steps used to remove the spikes.
This blog is based on an answer I posted to a Stackoverflow question at:
https://stackoverflow.com/questions/37556487/remove-spikes-from-signal-in-python
A solution Here&rsquo;s a general method for removing spikes from data. The code is at the end of this post."><meta property="og:title" content="Remove spikes from a dataset using python - mattoppenheim"><meta property="og:type" content="article"><meta property="og:url" content="https://mattoppenheim.github.io/post/2022/02/remove-spikes-from-a-dataset-using-python/"><meta property="og:image" content="https://mattoppenheim.github.io/images/default.png"><meta property="og:site_name" content="mattoppenheim"><meta property="og:description" content="Problem How to remove random spikes from data.
Summary Using the pandas library in python we can remove random spikes from data. For this blog, I create a sine wave with random spikes then show the steps used to remove the spikes.
This blog is based on an answer I posted to a Stackoverflow question at:
https://stackoverflow.com/questions/37556487/remove-spikes-from-signal-in-python
A solution Here&rsquo;s a general method for removing spikes from data. The code is at the end of this post."><meta property="og:locale" content="ja_JP"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="mattoppenheim"><meta name=twitter:url content="https://mattoppenheim.github.io/post/2022/02/remove-spikes-from-a-dataset-using-python/"><meta name=twitter:title content="Remove spikes from a dataset using python - mattoppenheim"><meta name=twitter:description content="Problem How to remove random spikes from data.
Summary Using the pandas library in python we can remove random spikes from data. For this blog, I create a sine wave with random spikes then show the steps used to remove the spikes.
This blog is based on an answer I posted to a Stackoverflow question at:
https://stackoverflow.com/questions/37556487/remove-spikes-from-signal-in-python
A solution Here&rsquo;s a general method for removing spikes from data. The code is at the end of this post."><meta name=twitter:image content="https://mattoppenheim.github.io/images/default.png"><script type=application/ld+json>{"@context":"http://schema.org","@type":"NewsArticle","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/mattoppenheim.github.io"},"headline":"Remove spikes from a dataset using python-mattoppenheim","image":{"@type":"ImageObject","url":"https:\/\/mattoppenheim.github.io\/images\/default.png","height":800,"width":800},"datePublished":"2022-02-25T00:00:00JST","dateModified":"2022-02-25T00:00:00JST","author":{"@type":"Person","name":"mattoppenheim"},"publisher":{"@type":"Organization","name":"mattoppenheim","logo":{"@type":"ImageObject","url":"https:\/\/mattoppenheim.github.ioimages/logo.png","width":600,"height":60}},"description":"Problem How to remove random spikes from data.\nSummary Using the pandas library in python we can remove random spikes from data. For this blog, I create a sine wave with random spikes then show the steps used to remove the spikes.\nThis blog is based on an answer I posted to a Stackoverflow question at:\nhttps:\/\/stackoverflow.com\/questions\/37556487\/remove-spikes-from-signal-in-python\nA solution Here\u0026rsquo;s a general method for removing spikes from data. The code is at the end of this post."}</script><link rel=canonical href=https://mattoppenheim.github.io/post/2022/02/remove-spikes-from-a-dataset-using-python/><link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,700" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.13.0/css/all.css crossorigin=anonymous><style>html{font-size:18px;background-color:rgba(236,239,241,.5)}@media(max-width:768px){html{font-size:15px}}body{color:#333;font-family:roboto slab,ヒラギノ角ゴ pro w3,hiragino kaku gothic pro,メイリオ,Meiryo,sans-serif;font-feature-settings:"palt";font-size:inherit;line-height:1rem;margin:0;padding:0}h1,h2,h3,h4,h5,h6{font-size:1rem;font-weight:700;line-height:1rem;margin:0}hr{border:0;border-top:1px dashed #cfd8dc;margin:1rem 0}p{margin:0;line-height:1rem}a{color:#2196f3;text-decoration:none;transition-duration:.3s}ul,ol{margin:0;padding:0}table{border-collapse:collapse;display:block;overflow-x:auto}th,td{font-size:.8rem;padding:.5rem}tr{border-bottom:1px dashed #ddd}main,aside{display:block}main{padding:1rem 0 3rem}.l-container{position:relative;max-width:68rem;margin:0 auto;padding:0 1rem}.l-container.thin{max-width:44rem}.l-header{background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);padding:1rem 0;text-align:center}.l-header .description{margin-top:.5rem;font-size:.8rem}.l-footer{background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);font-size:.6rem;font-weight:700;padding:1rem 0}.l-sidebar{margin:-1rem 0}@media(max-width:768px){.l-sidebar{margin-top:4rem}}.mrow{margin:0 -1rem;overflow:hidden}.mcol{box-sizing:border-box;float:left;padding:0 1rem}.c6{width:50%}.c4{width:33.26323833%}.c8{width:66.66666%}@media(max-width:768px){.mcol{width:100%;float:none}}.logo a{font-size:1.4rem;line-height:1.5rem;font-weight:700;color:#333}.articles{margin:-1rem 0;margin-bottom:1rem}.articles.sm{margin:-.5rem 0;margin-bottom:0}article{border-radius:4px;overflow:hidden}article.li{background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);height:20rem;overflow:hidden;margin:1rem 0}article.li>a{display:block;color:#333}article.li .inner{padding:1rem}article.li .thumb{height:8rem}article.li .title{color:#333;font-size:1.2rem;line-height:1.5rem;margin-bottom:.5rem}article.li .summary{font-size:.8rem;height:6rem;overflow:hidden;margin-top:1rem}article.li .summary::after{content:'...'}article.lism{background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);margin:.5rem 0}article.lism::after{content:'';display:block;clear:both}article.lism>a{display:block;color:#333}article.lism .inner{display:table-cell;vertical-align:middle;height:5rem;padding:0 .75rem}article.lism .thumb{width:5rem;height:5rem;float:left}article.lism .title{font-weight:700;font-size:.8rem;margin-bottom:.25rem}article.sn{background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);margin-bottom:1rem}article.sn .thumb{height:20rem}@media(max-width:768px){article.sn .thumb{height:10rem}}article.sn>.article-header,article.sn>.article-body,article.sn .article-footer{padding:2rem}article.sn>.article-body{padding:0 2rem}@media(max-width:768px){article.sn>.article-header,article.sn>.article-body,article.sn .article-footer{padding:1rem}article.sn>.article-body{padding:0 1rem}}article.sn>.article-header .title{font-size:1.8rem;line-height:2rem;margin-bottom:.5rem}@media(max-width:768px){article.sn>.article-header .title{font-size:1.4rem;line-height:1.5rem}}article.sn>.article-header .facts{margin-bottom:1rem}article.sn>.article-body{margin-bottom:1.5rem}article.sn>.article-body h2{border-bottom:.25rem solid #333;font-size:1.2rem;line-height:1.5rem;margin:1.5rem 0;padding:.5rem 0}article.sn>.article-body h3{border-left:.5rem solid #333;line-height:1.5rem;margin:1.5rem 0;padding:.125rem .5rem}article.sn>.article-body ul,article.sn>.article-body ol{margin:1.5rem 0;padding-left:1.5rem}article.sn>.article-body li{padding-bottom:.5rem;line-height:1.5rem}article.sn>.article-body li:last-child{padding-bottom:0}article.sn>.article-body p{margin:1rem 0;line-height:1.5rem}article.sn>.article-body strong,article.sn>.article-body em{font-style:normal;font-weight:700}article.sn>.article-body strong{box-shadow:0 -.5rem #ffc107 inset}article.sn>.article-body em{color:#8bc34a}article.sn>.article-body h2 code{font-size:1.1rem}article.sn>.article-body h1 code,article.sn>.article-body h3 code,article.sn>.article-body h4 code,article.sn>.article-body h5 code,article.sn>.article-body h6 code{font-size:.9rem}article.sn>.article-body code,article.sn>.article-body pre{font-family:Menlo,Consolas,monospace;font-size:.7rem}article.sn>.article-body pre{background-color:#333;color:#fff;line-height:1rem;margin:1.5rem -2rem;overflow:auto}@media(max-width:768px){article.sn>.article-body pre{margin:1.5rem -1rem}}article.sn>.article-body pre>code{display:block;padding:1rem 2rem}@media(max-width:768px){article.sn>.article-body pre>code{padding:1rem}}article.sn>.article-body p code,article.sn>.article-body h1 code,article.sn>.article-body h2 code,article.sn>.article-body h3 code,article.sn>.article-body h4 code,article.sn>.article-body h5 code,article.sn>.article-body h6 code,article.sn>.article-body li code{background-color:#eceff1;color:#333;border-radius:4px;margin:0 .25rem;padding:.375rem;white-space:nowrap}article.sn>.article-body blockquote{position:relative;border-left:.25rem solid #333;font-size:.8rem;padding:.125rem 1rem;margin:1.5rem 0}@media(max-width:768px){article.sn>.article-body blockquote{font-size:1rem}}article.sn>.article-body blockquote p{margin:.5rem 0;line-height:1rem}article.sn>.article-body figure{margin:1.5rem 0}article.sn>.article-body img,article.sn>.article-body figure img,article.sn>.article-body figure amp-img{box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);max-width:100%;height:100%}article.sn>.article-body figcaption{color:#cfd8dc;font-size:.8rem;font-weight:700;margin-top:.5rem}.facts li{display:inline;font-size:.8rem;margin-right:1rem}.facts i{color:#cfd8dc;margin-right:.5em}.facts.sm li{font-size:.7rem}section.sidebar{margin:2rem 0}section.sidebar>header{font-size:.8rem;font-weight:700;letter-spacing:4px;text-align:center;margin:1.5rem 0}section.footer{margin:1rem 0}section.footer>header{font-size:.8rem;margin:.5rem 0}section.footer>header::before{content:"- "}section.footer>header a{font-weight:700;color:#333;text-decoration:underline}.terms{margin:-.25rem}.terms li{display:inline-block}.terms a{display:block;float:left;background-color:#333;border-radius:4px;color:#fff;font-size:.7rem;margin:.25rem;padding:0 .75rem;line-height:1.75rem}.paging{text-align:center;padding:1rem 0}.paging a{display:inline-block;background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);border-radius:4px;color:#333;padding:0 1rem;line-height:3rem}.page-title{text-align:center;margin:1rem 0}.page-title::after{content:'';display:block;border-bottom:.25rem solid #333;width:3rem;margin:1.5rem auto}.page-title>.title{font-size:1.2rem;line-height:1.5rem}.share{padding:0}.share a{display:inline-block;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);min-width:1rem;height:2rem;border-radius:4px;color:#333;font-size:.8rem;font-weight:700;line-height:2rem;text-align:center;padding:0 .5rem}.adj article.lism{margin-bottom:1rem}.adj header{font-weight:700;font-size:.8rem}.toc{padding:0 2rem;margin:1rem 0}.toc nav>ul{background-color:#eceff1;border-radius:4px;display:inline-block;font-size:.8rem;padding:.5rem 1rem;word-break:break-all;list-style:none}.toc ul{padding:0}.toc ul ul{padding-left:1rem}.toc ul ul>li{font-weight:700;margin:.5rem 0;list-style-type:decimal}.toc ul ul ul{padding-left:1rem}.toc ul ul ul>li{list-style-type:disc;font-weight:500}.toc li{color:#90a4ae}@media(max-width:768px){.toc{padding:0 1rem}}.thumb{background-image:url(https://mattoppenheim.github.io/images/default.jpg);background-size:cover;background-position:50%}</style></head><body><header class=l-header><h1 class=logo><a href=https://mattoppenheim.github.io>mattoppenheim</a></h1></header><main><div class=l-container><div class=mrow><div class="mcol c8"><article class=sn><div class="thumb thumb-0ed92fccd3e6413a138119558128b4af"></div><header class=article-header><h1 class=title>Remove spikes from a dataset using python</h1><ul class=facts><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=2022-02-25T00:00:00JST>Feb 25, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i><a href=https://mattoppenheim.github.iopost/>POST</a></li></ul><aside class=share><a href="https://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2022%2f02%2fremove-spikes-from-a-dataset-using-python%2f&title=Remove%20spikes%20from%20a%20dataset%20using%20python" title=はてなブックマーク class=ht target=_blank rel="noopener nofollow">B!</a>
<a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2022%2f02%2fremove-spikes-from-a-dataset-using-python%2f&text=Remove%20spikes%20from%20a%20dataset%20using%20python&tw_p=tweetbutton" title=Twitterでシェア class=tw target=_blank rel="noopener nofollow"><i class="fab fa-twitter" aria-hidden=true></i></a>
<a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2022%2f02%2fremove-spikes-from-a-dataset-using-python%2f&t=Remove%20spikes%20from%20a%20dataset%20using%20python" title=Facebookでシェア class=fb target=_blank rel="noopener nofollow"><i class="fab fa-facebook" aria-hidden=true></i></a>
<a href="https://getpocket.com/edit?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2022%2f02%2fremove-spikes-from-a-dataset-using-python%2f&title=Remove%20spikes%20from%20a%20dataset%20using%20python" title=Pocketに保存 class=pk target=_blank rel="noopener nofollow"><i class="fab fa-get-pocket" aria-hidden=true></i></a>
<a href="https://social-plugins.line.me/lineit/share?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2022%2f02%2fremove-spikes-from-a-dataset-using-python%2f" title=LINEでシェア class=ln target=_blank rel="noopener nofollow"><i class="fab fa-line" aria-hidden=true></i></a></aside></header><div class=article-body><h1 id=problem>Problem</h1><p>How to remove random spikes from data.</p><h1 id=summary>Summary</h1><p>Using the <a href=pandas.pydata.org>pandas library</a> in <a href=python.org>python</a> we can remove random spikes from data. For this blog, I create a sine wave with random spikes then show the steps used to remove the spikes.</p><p>This blog is based on an answer I posted to a Stackoverflow question at:</p><p><a href=https://stackoverflow.com/questions/37556487/remove-spikes-from-signal-in-python>https://stackoverflow.com/questions/37556487/remove-spikes-from-signal-in-python</a></p><h1 id=a-solution>A solution</h1><p>Here&rsquo;s a general method for removing spikes from data. The code is at the end of this post. The variables that need to be tweaked for each data set are in upper case.</p><p>I tested this out using bathymetry data. For the sample code, I create a sine wave with random spikes. I call the clipped dataset <strong>y_spikey</strong>. A sine wave is reasonable example to use as the curves prevent a simple clipping function from being effective.</p><p><a href=https://i.stack.imgur.com/Onk1d.png><img src=images/Onk1d.png alt="Input data set"></a></p><h2 id=clip-the-data>Clip the data</h2><p>Replace data above HIGH_CUT and below LOW_CUT with np.nan. I call this data set <strong>y_clipped</strong>.</p><p>np.nan are &rsquo;not a number&rsquo; values, which appear as NaN when the data set is printed. The &rsquo;np.&rsquo; portion shows that this data type comes from the (numpy)[numpy.org] library.</p><p>Pandas is built on top of numpy so recognises the np.nan data type.</p><p>NaN values appear as gaps when graphed. The NaN values are ignored when calculating e.g. averages over ranges of values that include NaN values in them.</p><p>Using NaN values instead of zero values leads to less distortion of calculations in the next stages.</p><p>The data is clipped in the method def <strong>clip_data</strong>.</p><h2 id=fit-a-curve-to-the-clipped-data>Fit a curve to the clipped data</h2><p>Calculate a forwards-backwards exponential weighted moving average (FBEWMA) for the clipped data.</p><p>There is more about the FBEWMA with links to further explanation here: <a href=https://stackoverflow.com/questions/32430566/exponential-smoothing-average>https://stackoverflow.com/questions/32430566/exponential-smoothing-average</a></p><p>I call this dataset <strong>y_ewma_fb</strong>.</p><p>Why use the FBEWMA instead of a a simple sliding-window averaging function? Sliding an averaging window along the dataset in one direction leads to distortion compared with using the FBEWMA, which uses a sliding window in two directions - one from low to high values (the forwards part of FBEWMA), the other from high to low values (the backwards part of FBEWMA). Filtered data generally has a time shift of half of the filter window length.</p><p>With the FBEWMA, there are two filters. One works in an incrementing direction, the other in a decrementing direction. By having two filters, one starting at x=0 and the other starting at x=(maximum value of x), the time shifts are opposite and equal.</p><p>The filtered data is then added and the mean used as the output dataset. Doing this removes the time shift associated with using a single filter.</p><p>The previous step of clipping the data helps fit the FBEWMA curve to the data that we want to retain. Without clipping, the FBEWMA would have little spikes around the big spikes that we want to remove, making it harder to differentiate the spikes we want to remove from the FBEWMA in the next step.</p><p>The variable SPAN adjusts how long the averaging window is and should be adjusted for your data.</p><p><a href=https://i.stack.imgur.com/JzLyA.png><img src=images/JzLyA.png alt="y_clipped and y_ewma_fb"></a></p><p>This filter is created in the method <strong>ewma_fb</strong>.</p><h2 id=remove-data-that-is-an-outlier-compared-to-the-fbewma-curve>Remove data that is an outlier compared to the FBEWMA curve</h2><p>Replace the clipped data that is DELTA from the FBEWMA data with np.nan. I call this data set <strong>y_remove_outliers</strong>.</p><p>Using the np.nan data type means that gaps appear on the graph where the clipped data is more than DELTA from the FBEWMA curve.</p><p><a href=https://i.stack.imgur.com/D4R43.png><img src=images/D4R43.png alt="y_remove_outliers and y_ewma_fb"></a></p><p>The code that carries out this stage is in the method <strong>remove_outliers</strong>.</p><h2 id=interpolate-the-missing-values>Interpolate the missing values</h2><p>Use the pandas. interpolate function to replace the NaN values with data. I call the interpolated dataset <strong>y_interpolated</strong>. This is your output dataset.</p><p><a href=https://i.stack.imgur.com/DKO6U.png><img src=images/DKO6U.png alt="y_spikey and y_interpolated"></a></p><p>This stage is carried out by the line</p><pre tabindex=0><code>df[&#39;y_interpolated&#39;] = df[&#39;y_remove_outliers&#39;].interpolate()
</code></pre><h2 id=closing-comments>Closing comments</h2><p>When processing a large number of similar datasets, we usually spend some time testing the processing flow (we use the word &lsquo;flow&rsquo; for the set of filters). Different values for the variables such as the lengths of the FBEWMA filters are tested until we get something that &rsquo;looks right&rsquo;.</p><p>It could be that several stages of filtering are repeated. We might not like the interpolated data set, product, so pass this through a second set of FBEWMA, removing outliers and interpolation.</p><p>Maybe we will apply a smoothing function to the interpolated data to present a more &lsquo;pleasant&rsquo; looking final product. There is no &lsquo;one-size fits-all solution.</p><p>Data processing is still often led by &lsquo;do you like how it looks&rsquo; rather than rigorous measurable criteria.</p><h1 id=python-script>Python script</h1><pre tabindex=0><code>import logging
import numpy as np
import pandas as pd

logging.basicConfig(datefmt=&#39;%H:%M:%S&#39;,
                    stream=sys.stdout, level=logging.DEBUG,
                    format=&#39;%(asctime)s %(message)s&#39;)

# Distance away from the FBEWMA that data should be removed.
DELTA = 0.1

# clip data above this value:
HIGH_CLIP = 2.1

# clip data below this value:
LOW_CLIP = -2.1

# random values above this trigger a spike:
RAND_HIGH = 0.98

# random values below this trigger a negative spike:
RAND_LOW = 0.02

# How many samples to run the FBEWMA over.
SPAN = 10

# spike amplitude
SPIKE = 2

def clip_data(unclipped, high_clip, low_clip):
    &#39;&#39;&#39; Clip unclipped between high_clip and low_clip. 
    unclipped contains a single column of unclipped data.&#39;&#39;&#39;

    # convert to np.array to access the np.where method
    np_unclipped = np.array(unclipped)
    # clip data above HIGH_CLIP or below LOW_CLIP
    cond_high_clip = (np_unclipped &gt; HIGH_CLIP) | (np_unclipped &lt; LOW_CLIP)
    np_clipped = np.where(cond_high_clip, np.nan, np_unclipped)
    return np_clipped.tolist()

def create_sample_data():
    &#39;&#39;&#39; Create sine wave, amplitude +/-2 with random spikes. &#39;&#39;&#39;
    x = np.linspace(0, 2*np.pi, 1000)
    y = 2 * np.sin(x)
    df = pd.DataFrame(list(zip(x,y)), columns=[&#39;x&#39;, &#39;y&#39;])
    df[&#39;rand&#39;] = np.random.random_sample(len(x),)
    # create random positive and negative spikes
    cond_spike_high = (df[&#39;rand&#39;] &gt; RAND_HIGH)
    df[&#39;spike_high&#39;] = np.where(cond_spike_high, SPIKE, 0)
    cond_spike_low = (df[&#39;rand&#39;] &lt; RAND_LOW)
    df[&#39;spike_low&#39;] = np.where(cond_spike_low, -SPIKE, 0)
    df[&#39;y_spikey&#39;] = df[&#39;y&#39;] + df[&#39;spike_high&#39;] + df[&#39;spike_low&#39;]
    return df

def ewma_fb(df_column, span):
    &#39;&#39;&#39; Apply forwards, backwards exponential weighted moving average (EWMA) to df_column. &#39;&#39;&#39;
    # Forwards EWMA.
    fwd = pd.Series.ewm(df_column, span=span).mean()
    # Backwards EWMA.
    bwd = pd.Series.ewm(df_column[::-1],span=10).mean()
    # Add and take the mean of the forwards and backwards EWMA.
    stacked_ewma = np.vstack(( fwd, bwd[::-1] ))
    fb_ewma = np.mean(stacked_ewma, axis=0)
    return fb_ewma

def remove_outliers(spikey, fbewma, delta):
    &#39;&#39;&#39; Remove data from df_spikey that is &gt; delta from fbewma. &#39;&#39;&#39;
    np_spikey = np.array(spikey)
    np_fbewma = np.array(fbewma)
    cond_delta = (np.abs(np_spikey-np_fbewma) &gt; delta)
    np_remove_outliers = np.where(cond_delta, np.nan, np_spikey)
    return np_remove_outliers

def main():
    df = create_sample_data()

    df[&#39;y_clipped&#39;] = clip_data(df[&#39;y_spikey&#39;].tolist(), HIGH_CLIP, LOW_CLIP)
    df[&#39;y_ewma_fb&#39;] = ewma_fb(df[&#39;y_clipped&#39;], SPAN)
    df[&#39;y_remove_outliers&#39;] = remove_outliers(df[&#39;y_clipped&#39;].tolist(), df[&#39;y_ewma_fb&#39;].tolist(), DELTA)
    df[&#39;y_interpolated&#39;] = df[&#39;y_remove_outliers&#39;].interpolate()

    ax = df.plot(x=&#39;x&#39;, y=&#39;y_spikey&#39;, color=&#39;blue&#39;, alpha=0.5)
    ax2 = df.plot(x=&#39;x&#39;, y=&#39;y_interpolated&#39;, color=&#39;black&#39;, ax=ax)

main()
</code></pre></div><footer class=article-footer><aside class=share><a href="https://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2022%2f02%2fremove-spikes-from-a-dataset-using-python%2f&title=Remove%20spikes%20from%20a%20dataset%20using%20python" title=はてなブックマーク class=ht target=_blank rel="noopener nofollow">B!</a>
<a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2022%2f02%2fremove-spikes-from-a-dataset-using-python%2f&text=Remove%20spikes%20from%20a%20dataset%20using%20python&tw_p=tweetbutton" title=Twitterでシェア class=tw target=_blank rel="noopener nofollow"><i class="fab fa-twitter" aria-hidden=true></i></a>
<a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2022%2f02%2fremove-spikes-from-a-dataset-using-python%2f&t=Remove%20spikes%20from%20a%20dataset%20using%20python" title=Facebookでシェア class=fb target=_blank rel="noopener nofollow"><i class="fab fa-facebook" aria-hidden=true></i></a>
<a href="https://getpocket.com/edit?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2022%2f02%2fremove-spikes-from-a-dataset-using-python%2f&title=Remove%20spikes%20from%20a%20dataset%20using%20python" title=Pocketに保存 class=pk target=_blank rel="noopener nofollow"><i class="fab fa-get-pocket" aria-hidden=true></i></a>
<a href="https://social-plugins.line.me/lineit/share?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2022%2f02%2fremove-spikes-from-a-dataset-using-python%2f" title=LINEでシェア class=ln target=_blank rel="noopener nofollow"><i class="fab fa-line" aria-hidden=true></i></a></aside><section class=footer><header><a href=https://mattoppenheim.github.iotags/>TAGS</a></header><ul class=terms><li><a href=https://mattoppenheim.github.iotags/despike/>despike</a></li><li><a href=https://mattoppenheim.github.iotags/pandas/>pandas</a></li><li><a href=https://mattoppenheim.github.iotags/python/>python</a></li><li><a href=https://mattoppenheim.github.iotags/signal-processing/>signal-processing</a></li></ul></section></footer></article><div class="adj mrow"><div class="mcol c6"><header>Next Article</header><article class=lism><a href=https://mattoppenheim.github.io/post/2022/04/installing-kicad-nightly-build-on-debian-11/><div class="thumb thumb-0aee508cb6a6c2dcc12e1d5c98ec725a"></div><div class=inner><div class=title>Installing kicad nightly-build on Debian 11</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=8007-04-08T00:00:00JST>Apr 8, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article></div><div class="mcol c6"><header>Previous Article</header><article class=lism><a href=https://mattoppenheim.github.io/post/2021/12/bendlabs-single-axis-bend-sensor/><div class="thumb thumb-d204e5f23fe1155f37071ecc587de825"></div><div class=inner><div class=title>Bendlabs single-axis bend sensor</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=30007-12-30T00:00:00JST>Dec 30, 2021</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article></div></div></div><div class="mcol c4"><aside class=l-sidebar><section class=sidebar><header>LATESTS</header><div class="articles sm"><article class=lism><a href=https://mattoppenheim.github.io/post/2022/10/converting-kicad-nightly-build-to-kicad-stable/><div class="thumb thumb-a650b124ce45e26ebb7a65e2357d703b"></div><div class=inner><div class=title>Converting kicad-nightly build to kicad stable</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=12007-10-12T00:00:00JST>Oct 12, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/10/jacdac-using-the-black-magic-programmer/><div class="thumb thumb-055f630d6fb825ab775e5939e6223e0d"></div><div class=inner><div class=title>Jacdac: Using the Black Magic programmer</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=12007-10-12T00:00:00JST>Oct 12, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/05/using-microbits-to-send-data-to-and-from-an-arduino-wirelessly/><div class="thumb thumb-a5214e9b999e197bd08ef76d82293a4f"></div><div class=inner><div class=title>Using micro:bits to send data to and from an Arduino wirelessly</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=10007-05-10T00:00:00JST>May 10, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/05/logic-level-converter-between-an-arduino-and-microbit-using-a-fet-transistor/><div class="thumb thumb-2513cdb6f23eb9ce12686600f4e5e3fe"></div><div class=inner><div class=title>Logic level converter between an Arduino Uno and micro:bit using a FET transistor</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=1007-05-01T00:00:00JST>May 1, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/04/downloading-youtube-videos-using-termux-and-youtube-dl-on-android/><div class="thumb thumb-99946926ea762383b64f3640808c8ef5"></div><div class=inner><div class=title>Downloading YouTube videos using Termux and youtube-dl on Android</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=29007-04-29T00:00:00JST>Apr 29, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/04/kicad-fixing-invisible-gaps-in-board-outlines-on-the-edge-cuts-layer/><div class="thumb thumb-b8a8e92b4bd792ef7ae9e09662b62192"></div><div class=inner><div class=title>Kicad - fixing invisible gaps in board outlines on the Edge.Cuts layer</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=16007-04-16T00:00:00JST>Apr 16, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/04/installing-kicad-nightly-build-on-debian-11/><div class="thumb thumb-0aee508cb6a6c2dcc12e1d5c98ec725a"></div><div class=inner><div class=title>Installing kicad nightly-build on Debian 11</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=8007-04-08T00:00:00JST>Apr 8, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/02/remove-spikes-from-a-dataset-using-python/><div class="thumb thumb-0ed92fccd3e6413a138119558128b4af"></div><div class=inner><div class=title>Remove spikes from a dataset using python</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=25007-02-25T00:00:00JST>Feb 25, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2021/12/bendlabs-single-axis-bend-sensor/><div class="thumb thumb-d204e5f23fe1155f37071ecc587de825"></div><div class=inner><div class=title>Bendlabs single-axis bend sensor</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=30007-12-30T00:00:00JST>Dec 30, 2021</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2021/12/mounting-an-android-phone-on-debian-linux-to-synchronise-files/><div class="thumb thumb-dcfcf5c61d3126c3fa9b237336aa9277"></div><div class=inner><div class=title>Mounting an Android phone on Debian Linux to synchronise files</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=28007-12-28T00:00:00JST>Dec 28, 2021</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article></div></section><section class=sidebar><header>TAGS</header><ul class=terms><li><a href=https://mattoppenheim.github.iotags/microbit>microbit <span class=count>(26)</span></a></li><li><a href=https://mattoppenheim.github.iotags/python>python <span class=count>(16)</span></a></li><li><a href=https://mattoppenheim.github.iotags/microbit-2>microbit-2 <span class=count>(9)</span></a></li><li><a href=https://mattoppenheim.github.iotags/bbc-microbit>bbc-microbit <span class=count>(8)</span></a></li><li><a href=https://mattoppenheim.github.iotags/assistive-technology>assistive-technology <span class=count>(7)</span></a></li><li><a href=https://mattoppenheim.github.iotags/yotta>yotta <span class=count>(7)</span></a></li><li><a href=https://mattoppenheim.github.iotags/linux>linux <span class=count>(6)</span></a></li><li><a href=https://mattoppenheim.github.iotags/micropython>micropython <span class=count>(5)</span></a></li><li><a href=https://mattoppenheim.github.iotags/arduino>arduino <span class=count>(4)</span></a></li><li><a href=https://mattoppenheim.github.iotags/debian>debian <span class=count>(4)</span></a></li></ul></section></aside></div></div></main><footer class=l-footer><div class=l-container><p><span class=h-logo>&copy; mattoppenheim</span></p><aside><p>Powered by <a href=https://gohugo.io/>Hugo</a>.</p><p><a href=https://github.com/dim0627/hugo_theme_robust>Robust</a> designed by <a href=http://yet.unresolved.xyz/>Daisuke Tsuji</a>.</p></aside></div></footer></body></html>