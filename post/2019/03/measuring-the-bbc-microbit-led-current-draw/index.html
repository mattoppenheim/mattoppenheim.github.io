<!doctype html><html><head><meta charset=utf-8><title>Measuring the BBC micro:bit LED current draw - mattoppenheim</title><meta name=pinterest content="nopin"><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><link rel="dns-prefetch preconnect" href=https://fonts.gstatic.com crossorigin><link rel="dns-prefetch preconnect" href=https://use.fontawesome.com crossorigin><meta name=theme-color content="#263238"><meta name=generator content="Hugo 0.107.0"><link rel=apple-touch-icon href=https://mattoppenheim.github.ioimages/logo.png><meta name=description content="Summary: I looked at the voltage and current supplied to the BBC micro:bit for different numbers of active LEDs. The voltage to the LEDs is pulsed at about 55Hz, with each LED on about 1/3 of the time at maximum intensity. The frequency is high enough that the LED appears continuously lit. The current draw from a single pin is in spec for the microcontroller. The current supplied to each LED decreases as the total number of LEDs being sourced from the same microcontroller pin increases."><meta property="og:title" content="Measuring the BBC micro:bit LED current draw - mattoppenheim"><meta property="og:type" content="article"><meta property="og:url" content="https://mattoppenheim.github.io/post/2019/03/measuring-the-bbc-microbit-led-current-draw/"><meta property="og:image" content="https://mattoppenheim.github.io/images/default.png"><meta property="og:site_name" content="mattoppenheim"><meta property="og:description" content="Summary: I looked at the voltage and current supplied to the BBC micro:bit for different numbers of active LEDs. The voltage to the LEDs is pulsed at about 55Hz, with each LED on about 1/3 of the time at maximum intensity. The frequency is high enough that the LED appears continuously lit. The current draw from a single pin is in spec for the microcontroller. The current supplied to each LED decreases as the total number of LEDs being sourced from the same microcontroller pin increases."><meta property="og:locale" content="ja_JP"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="mattoppenheim"><meta name=twitter:url content="https://mattoppenheim.github.io/post/2019/03/measuring-the-bbc-microbit-led-current-draw/"><meta name=twitter:title content="Measuring the BBC micro:bit LED current draw - mattoppenheim"><meta name=twitter:description content="Summary: I looked at the voltage and current supplied to the BBC micro:bit for different numbers of active LEDs. The voltage to the LEDs is pulsed at about 55Hz, with each LED on about 1/3 of the time at maximum intensity. The frequency is high enough that the LED appears continuously lit. The current draw from a single pin is in spec for the microcontroller. The current supplied to each LED decreases as the total number of LEDs being sourced from the same microcontroller pin increases."><meta name=twitter:image content="https://mattoppenheim.github.io/images/default.png"><script type=application/ld+json>{"@context":"http://schema.org","@type":"NewsArticle","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/mattoppenheim.github.io"},"headline":"Measuring the BBC micro:bit LED current draw-mattoppenheim","image":{"@type":"ImageObject","url":"https:\/\/mattoppenheim.github.io\/images\/default.png","height":800,"width":800},"datePublished":"2019-03-06T00:00:00JST","dateModified":"2019-03-06T00:00:00JST","author":{"@type":"Person","name":"mattoppenheim"},"publisher":{"@type":"Organization","name":"mattoppenheim","logo":{"@type":"ImageObject","url":"https:\/\/mattoppenheim.github.ioimages/logo.png","width":600,"height":60}},"description":"Summary: I looked at the voltage and current supplied to the BBC micro:bit for different numbers of active LEDs. The voltage to the LEDs is pulsed at about 55Hz, with each LED on about 1\/3 of the time at maximum intensity. The frequency is high enough that the LED appears continuously lit. The current draw from a single pin is in spec for the microcontroller. The current supplied to each LED decreases as the total number of LEDs being sourced from the same microcontroller pin increases."}</script><link rel=canonical href=https://mattoppenheim.github.io/post/2019/03/measuring-the-bbc-microbit-led-current-draw/><link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,700" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.13.0/css/all.css crossorigin=anonymous><style>html{font-size:18px;background-color:rgba(236,239,241,.5)}@media(max-width:768px){html{font-size:15px}}body{color:#333;font-family:roboto slab,ヒラギノ角ゴ pro w3,hiragino kaku gothic pro,メイリオ,Meiryo,sans-serif;font-feature-settings:"palt";font-size:inherit;line-height:1rem;margin:0;padding:0}h1,h2,h3,h4,h5,h6{font-size:1rem;font-weight:700;line-height:1rem;margin:0}hr{border:0;border-top:1px dashed #cfd8dc;margin:1rem 0}p{margin:0;line-height:1rem}a{color:#2196f3;text-decoration:none;transition-duration:.3s}ul,ol{margin:0;padding:0}table{border-collapse:collapse;display:block;overflow-x:auto}th,td{font-size:.8rem;padding:.5rem}tr{border-bottom:1px dashed #ddd}main,aside{display:block}main{padding:1rem 0 3rem}.l-container{position:relative;max-width:68rem;margin:0 auto;padding:0 1rem}.l-container.thin{max-width:44rem}.l-header{background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);padding:1rem 0;text-align:center}.l-header .description{margin-top:.5rem;font-size:.8rem}.l-footer{background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);font-size:.6rem;font-weight:700;padding:1rem 0}.l-sidebar{margin:-1rem 0}@media(max-width:768px){.l-sidebar{margin-top:4rem}}.mrow{margin:0 -1rem;overflow:hidden}.mcol{box-sizing:border-box;float:left;padding:0 1rem}.c6{width:50%}.c4{width:33.26323833%}.c8{width:66.66666%}@media(max-width:768px){.mcol{width:100%;float:none}}.logo a{font-size:1.4rem;line-height:1.5rem;font-weight:700;color:#333}.articles{margin:-1rem 0;margin-bottom:1rem}.articles.sm{margin:-.5rem 0;margin-bottom:0}article{border-radius:4px;overflow:hidden}article.li{background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);height:20rem;overflow:hidden;margin:1rem 0}article.li>a{display:block;color:#333}article.li .inner{padding:1rem}article.li .thumb{height:8rem}article.li .title{color:#333;font-size:1.2rem;line-height:1.5rem;margin-bottom:.5rem}article.li .summary{font-size:.8rem;height:6rem;overflow:hidden;margin-top:1rem}article.li .summary::after{content:'...'}article.lism{background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);margin:.5rem 0}article.lism::after{content:'';display:block;clear:both}article.lism>a{display:block;color:#333}article.lism .inner{display:table-cell;vertical-align:middle;height:5rem;padding:0 .75rem}article.lism .thumb{width:5rem;height:5rem;float:left}article.lism .title{font-weight:700;font-size:.8rem;margin-bottom:.25rem}article.sn{background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);margin-bottom:1rem}article.sn .thumb{height:20rem}@media(max-width:768px){article.sn .thumb{height:10rem}}article.sn>.article-header,article.sn>.article-body,article.sn .article-footer{padding:2rem}article.sn>.article-body{padding:0 2rem}@media(max-width:768px){article.sn>.article-header,article.sn>.article-body,article.sn .article-footer{padding:1rem}article.sn>.article-body{padding:0 1rem}}article.sn>.article-header .title{font-size:1.8rem;line-height:2rem;margin-bottom:.5rem}@media(max-width:768px){article.sn>.article-header .title{font-size:1.4rem;line-height:1.5rem}}article.sn>.article-header .facts{margin-bottom:1rem}article.sn>.article-body{margin-bottom:1.5rem}article.sn>.article-body h2{border-bottom:.25rem solid #333;font-size:1.2rem;line-height:1.5rem;margin:1.5rem 0;padding:.5rem 0}article.sn>.article-body h3{border-left:.5rem solid #333;line-height:1.5rem;margin:1.5rem 0;padding:.125rem .5rem}article.sn>.article-body ul,article.sn>.article-body ol{margin:1.5rem 0;padding-left:1.5rem}article.sn>.article-body li{padding-bottom:.5rem;line-height:1.5rem}article.sn>.article-body li:last-child{padding-bottom:0}article.sn>.article-body p{margin:1rem 0;line-height:1.5rem}article.sn>.article-body strong,article.sn>.article-body em{font-style:normal;font-weight:700}article.sn>.article-body strong{box-shadow:0 -.5rem #ffc107 inset}article.sn>.article-body em{color:#8bc34a}article.sn>.article-body h2 code{font-size:1.1rem}article.sn>.article-body h1 code,article.sn>.article-body h3 code,article.sn>.article-body h4 code,article.sn>.article-body h5 code,article.sn>.article-body h6 code{font-size:.9rem}article.sn>.article-body code,article.sn>.article-body pre{font-family:Menlo,Consolas,monospace;font-size:.7rem}article.sn>.article-body pre{background-color:#333;color:#fff;line-height:1rem;margin:1.5rem -2rem;overflow:auto}@media(max-width:768px){article.sn>.article-body pre{margin:1.5rem -1rem}}article.sn>.article-body pre>code{display:block;padding:1rem 2rem}@media(max-width:768px){article.sn>.article-body pre>code{padding:1rem}}article.sn>.article-body p code,article.sn>.article-body h1 code,article.sn>.article-body h2 code,article.sn>.article-body h3 code,article.sn>.article-body h4 code,article.sn>.article-body h5 code,article.sn>.article-body h6 code,article.sn>.article-body li code{background-color:#eceff1;color:#333;border-radius:4px;margin:0 .25rem;padding:.375rem;white-space:nowrap}article.sn>.article-body blockquote{position:relative;border-left:.25rem solid #333;font-size:.8rem;padding:.125rem 1rem;margin:1.5rem 0}@media(max-width:768px){article.sn>.article-body blockquote{font-size:1rem}}article.sn>.article-body blockquote p{margin:.5rem 0;line-height:1rem}article.sn>.article-body figure{margin:1.5rem 0}article.sn>.article-body img,article.sn>.article-body figure img,article.sn>.article-body figure amp-img{box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);max-width:100%;height:100%}article.sn>.article-body figcaption{color:#cfd8dc;font-size:.8rem;font-weight:700;margin-top:.5rem}.facts li{display:inline;font-size:.8rem;margin-right:1rem}.facts i{color:#cfd8dc;margin-right:.5em}.facts.sm li{font-size:.7rem}section.sidebar{margin:2rem 0}section.sidebar>header{font-size:.8rem;font-weight:700;letter-spacing:4px;text-align:center;margin:1.5rem 0}section.footer{margin:1rem 0}section.footer>header{font-size:.8rem;margin:.5rem 0}section.footer>header::before{content:"- "}section.footer>header a{font-weight:700;color:#333;text-decoration:underline}.terms{margin:-.25rem}.terms li{display:inline-block}.terms a{display:block;float:left;background-color:#333;border-radius:4px;color:#fff;font-size:.7rem;margin:.25rem;padding:0 .75rem;line-height:1.75rem}.paging{text-align:center;padding:1rem 0}.paging a{display:inline-block;background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);border-radius:4px;color:#333;padding:0 1rem;line-height:3rem}.page-title{text-align:center;margin:1rem 0}.page-title::after{content:'';display:block;border-bottom:.25rem solid #333;width:3rem;margin:1.5rem auto}.page-title>.title{font-size:1.2rem;line-height:1.5rem}.share{padding:0}.share a{display:inline-block;box-shadow:0 0 0 1px rgba(63,63,68,5%),0 1px 3px rgba(63,63,68,.1),0 1px 2px rgba(0,0,0,5%);min-width:1rem;height:2rem;border-radius:4px;color:#333;font-size:.8rem;font-weight:700;line-height:2rem;text-align:center;padding:0 .5rem}.adj article.lism{margin-bottom:1rem}.adj header{font-weight:700;font-size:.8rem}.toc{padding:0 2rem;margin:1rem 0}.toc nav>ul{background-color:#eceff1;border-radius:4px;display:inline-block;font-size:.8rem;padding:.5rem 1rem;word-break:break-all;list-style:none}.toc ul{padding:0}.toc ul ul{padding-left:1rem}.toc ul ul>li{font-weight:700;margin:.5rem 0;list-style-type:decimal}.toc ul ul ul{padding-left:1rem}.toc ul ul ul>li{list-style-type:disc;font-weight:500}.toc li{color:#90a4ae}@media(max-width:768px){.toc{padding:0 1rem}}.thumb{background-image:url(https://mattoppenheim.github.io/images/default.jpg);background-size:cover;background-position:50%}</style></head><body><header class=l-header><h1 class=logo><a href=https://mattoppenheim.github.io>mattoppenheim</a></h1></header><main><div class=l-container><div class=mrow><div class="mcol c8"><article class=sn><div class="thumb thumb-4914097fdd010502cccc522a6fb65930"></div><header class=article-header><h1 class=title>Measuring the BBC micro:bit LED current draw</h1><ul class=facts><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=2019-03-06T00:00:00JST>Mar 6, 2019</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i><a href=https://mattoppenheim.github.iopost/>POST</a></li></ul><aside class=share><a href="https://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2019%2f03%2fmeasuring-the-bbc-microbit-led-current-draw%2f&title=Measuring%20the%20BBC%20micro%3abit%20LED%20current%20draw" title=はてなブックマーク class=ht target=_blank rel="noopener nofollow">B!</a>
<a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2019%2f03%2fmeasuring-the-bbc-microbit-led-current-draw%2f&text=Measuring%20the%20BBC%20micro%3abit%20LED%20current%20draw&tw_p=tweetbutton" title=Twitterでシェア class=tw target=_blank rel="noopener nofollow"><i class="fab fa-twitter" aria-hidden=true></i></a>
<a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2019%2f03%2fmeasuring-the-bbc-microbit-led-current-draw%2f&t=Measuring%20the%20BBC%20micro%3abit%20LED%20current%20draw" title=Facebookでシェア class=fb target=_blank rel="noopener nofollow"><i class="fab fa-facebook" aria-hidden=true></i></a>
<a href="https://getpocket.com/edit?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2019%2f03%2fmeasuring-the-bbc-microbit-led-current-draw%2f&title=Measuring%20the%20BBC%20micro%3abit%20LED%20current%20draw" title=Pocketに保存 class=pk target=_blank rel="noopener nofollow"><i class="fab fa-get-pocket" aria-hidden=true></i></a>
<a href="https://social-plugins.line.me/lineit/share?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2019%2f03%2fmeasuring-the-bbc-microbit-led-current-draw%2f" title=LINEでシェア class=ln target=_blank rel="noopener nofollow"><i class="fab fa-line" aria-hidden=true></i></a></aside></header><div class=article-body><p>Summary: I looked at the voltage and current supplied to the BBC micro:bit for different numbers of active LEDs. The voltage to the LEDs is pulsed at about 55Hz, with each LED on about 1/3 of the time at maximum intensity. The frequency is high enough that the LED appears continuously lit. The current draw from a single pin is in spec for the microcontroller. The current supplied to each LED decreases as the total number of LEDs being sourced from the same microcontroller pin increases. If the LED ntensity is decreased in code, then the LED is active for a smaller fraction of each voltage cycle.</p><p>An interesting question at <a href="https://www.google.com/url?q=https%3A%2F%2Felectronics.stackexchange.com%2Fquestions%2F422057%2Fled-current-on-bbc-microbit&sa=D&sntz=1&usg=AFQjCNGeGEwKzCTkOA_dH2gRkVm1E3r8vw">stackexchange</a> asked how the pins to the microcontroller on the microbit could handle the current to and from all 25 of the LEDs on the board. At first glance, it looks like there are too many LEDs being supplied by too few pins to stay within the 5mA current limit for a single pin on the Nordic nRF51822 microcontroller.</p><p>There is a schematic for the microbit board <a href=https://github.com/bbcmicrobit/hardware/blob/master/SCH_BBC-Microbit_V1.3B.pdf>on github</a>. A screenshot showing how the microcontroller pins are connected to the LEDs, taken from sheet 1 and 5 of the github site is shown below.</p><p><img src=images/led_schematic-1024x666.jpg alt></p><p>Microbit schematic showing how the LEDs are connected, taken from the microbit Github site.</p><p><img src=images/microcontroller_schematic_marked.jpg alt></p><p>Nordic nRF51822 pinout on the microbit from Github, with the pins that connect to the LEDs indicated.</p><p>There are three pins called ROW1-ROW3 that supply current to the anodes (the left of the LED symbol) of all 25 LEDs. Pin PO.13 on the microcontroller is connected to ROW1 and supplies 9 LEDs. Pin PO.14 connects to ROW2 and supplies 7 LEDs. Pin PO.15 connects to ROW3 and supplies 9 LEDs. According to the datasheet for the microcontroller, up to 3 pins can supply or sink up to 5mA in &lsquo;high-drive&rsquo; mode. The rest can source or sink 1.5mA each.</p><p>The cathode (the bit of the LED connected to the resistor) of each LED is connected to one of nine 220 Ohm resistors. Upto 3 LED cathodes are connected to each resistor. Each of the nine resistors is then connected to a single microcontroller pin, to sink the LED current.</p><p>A limit of 5mA from a single pin to source current to 9 LEDs is not a lot. So what is happening? Are the pins being overloaded?</p><p>I pulled the C++ microbit compiler code from the <a href=https://github.com/lancaster-university/microbit-dal>lancaster university github</a>. It looks like one row of the microbit display is illuminated at a time and the display constantly scans through the rows.</p><p>Anything that turns on and off at a frequency greater than about 15Hz appears as if it is constantly on.</p><p>Using a power supply, I measured the current draw with different numbers of LEDs active. The voltage applied was 3.00V from a TTi EX345RD power supply.</p><p>The results surprised me:</p><p>LEDS current in mA<br>0         4.74<br>1         5.79<br>5         8.63<br>10      11.31<br>15      12.75<br>20      13.45<br>25      14.01</p><p>So about 14.01-4.74 = 9.27mA extra current is being used to supply 25 LEDs.</p><p>I used an <a href=https://store.digilentinc.com/analog-discovery-2-100msps-usb-oscilloscope-logic-analyzer-and-variable-power-supply/>Analog Discovery 2</a> with its Wavefroms software to both power the board and as a &lsquo;scope. A Fluke multimeter measured the current and was used to verify that the supply voltage stayed constant.</p><p>The Analog Discover 2 supply pins were connected to the ground and 3V pin on the edge connector for the microbit. With a supply voltage of 3V from the Analog Discovery 2, I measured 3.001V across the ground and 3V edge connector pins for 1 LED on and 2.994V with all 25 LEDs on, so the voltage drop across the supply pins is 0.2% while increasing the number of active LEDs. Not much of a voltage drop.</p><p>With the &lsquo;scope, I can see that the voltage to each LED is indeed pulsed. The screen shot taken from the Waveform software below shows what I saw &lsquo;scoping the anode of an LED. The red vertical lines show where I measured time intervals. I am fairly sure that I am &lsquo;scoping the LED&rsquo;s anthode as I could count 9 of the pins connected to this side of the LED and 3 at the other end. Which agrees with the schematic. Plus I used my Fluke to verify the LED polarity. Matty likes to double check what he is measuring after having made so many, many mistakes over the years.</p><p><img src=images/led_pwm_marked-802x1024.png alt></p><p>Voltage on a single LED anode, red lines show where I measured time intervals.</p><p>Clearly the current draw I measured from the power supply was showing the average current. The current through the LEDs will vary with the voltage. The resistor is 220 Ohm. The current will be V^2/R, where V is the voltage across the resistor.</p><p>The LED voltage at the anode is high for 5.8824ms out of 17.914ms = 32.83% duty cycle. So the pin is high for about 1/3 of the time. This makes sense - one pin out of the three that supply current to the LEDs is active at a time. The pulse frequency is 55.821Hz. So the pulsing is invisible to the eye.</p><p>The frequency and pulse widths do not change with the number of LEDs that are on. What does change is the anode and cathode amplitude. This drops as the number of LEDs on increases. The supply voltage to the microbit stayed almost constant though.</p><p>The image below shows the anode voltage on two separate supply pins, showing that they are indeed turned on at different times. Should I have three probes, the gap would be filled in by &lsquo;scoping the pin supplying the third row of LEDs.</p><p><img src=images/led_pwm_two-channels-1-824x1024.png alt></p><p>Voltage on the anodes for two LEDs supplied by different pins.</p><p>With no LEDs on, the voltage rail was 3.0200 on the &lsquo;scope. Fair enough. That&rsquo;s pretty much the supply rail. With all LEDs on, I measured two voltages, 2.0896V and 2.1640V. If you&rsquo;ve been paying attention, it won&rsquo;t be a suprise that the higher voltage occurs on 7 LEDs (ROW2 on the schematic) and the lower on the remaining 18 (ROW1 and ROW3 on the schematic).</p><p>Let&rsquo;s look at the cathode of one of the LEDs. A screen grab is shown below. With a single lit LED, the cathode is at 3V for 2/3 of the time as the sink pin goes high to prevent current, from, well, being sinked. When it goes low, current can flow from through the LED and the resistor and back to ground through the microcontroller pin. Thus completing the circuit and allowing the LED to light up. When the current is flowing, the voltage drops at the cathode. In this screen grab, with only 3 LEDs active, I measured 912.34mV at the cathode of the lit LED. Which makes for a current of 0.91234^2/220 = 3.78mA through the single LED and resistor. Note: I had the LEDs set on maximum intensity.</p><p><img src=images/led_pwm_cathode_one_LED.png alt></p><p>Voltage on an LED cathode when only one LED is active. Maximum LED intensity. x-axis: one square is 5ms.</p><p>What is interesting, is that the low value of the cathode voltage decreases with an increasing number of lit LEDs. So the current flowing through the LED must similarly decrease. So the voltage and thus current decreases with increasing lit LEDs, which means that the brightness also decreases. Similarly, the fraction of time that the cathode is high also decreases as the number of active LEDs increases, which makes sense, as for a greater fraction of the time the multiplexed cathode will be sinking current.</p><p>With all LEDs on, I measure 356.81mV for 1/3 of the time and 292.46mV for 2/3 of the time. Can you guess why the voltage is stepped between the two values? I suspect it as the voltage switches between supplying 9 and 7 LEDs. Please see the two &lsquo;scope grabs below.</p><p><img src=images/led_pwm_cathode_all_LED-2-1024x505.png alt></p><p>Cathode voltage, all LEDs active. Maximum intensity. x-axis: one square is 5ms.</p><p><img src=images/led_pwm_cathode_all_LED_zoomed-1024x509.png alt></p><p>Cathode voltage, all LEDs active. Maximum intensity. zoomed. x-axis: one square is 5ms.</p><p>The human eye is not so good at discerning different light intensities. I think that having a bunch of LEDs not so brightly lit as a single one also helps fool the eye in judging their individual brightness.</p><p>With all LEDs on, the maximum current flow through the 220 Ohm resistor for the pin supplying 7 LEDs is 0.35681^2/220 = 0.5787mA. So for 7 LEDs, the total draw is 4.05mA.</p><p>For the 9 LED pins, the current per LED is 0.29246^2/220 = 0.3888mA. So for 9 LEDs, this is 3.499mA, again inside the 5mA spec for a single &lsquo;high-drive&rsquo; pin to supply. However, the pin is only active for about 1/3 of the time. So the average current flow per LED will be 1/3 of the above values.</p><p>The current sinking into the pins that sink current is within the 1.5mA spec for a non &lsquo;high-drive&rsquo; pin.</p><p>Lets look at all 25 LEDs active. About (7 x 0.5787 x 1/3)+ (9 x 0.3888 x 2/3) is being drawn at any instant. Which is 4.125mA. I measured an increase of around 9mA with all LEDs active. Hmmm, where does the extra current go? I&rsquo;m open to suggestions. I&rsquo;ve gone down the rabbit-hole with this. Time to move onto something else.</p><p>Ta-daaaaaaa.</p><p>An obvious question is: How do the traces look when the intensity changes? I edited the code shown at the end of the article to have the minimum LED intensity. Prior to this, I&rsquo;d had everything set at maximum intensity.</p><p>Looking at the &lsquo;scope, the anode voltage stayed the same as for when we have maximum intensity - it is high for about 1/3 of the time for any given LED. Below see the cathode voltage for minimum intensity, all LEDs lit and a repeat of the image for when the LED intensity is maximum. We can see that the cathode voltage goes low, which allows current to flow, for much less of the cycle when the intensity is at a minimum. Which makes sense. At maximum intensity, current flows for almost all of the time that the anode voltage is high (about 1/3 of the time). I measured the cathode coming low for only 32.637us at minimum intensity, which is only about 0.18% of the illumination cycle, compared with the roughly 32% of the time when at maximum intensity.</p><p><img src=images/led_pwm_cathode_all_LED_zoomed_min_intensity-1-1024x502.png alt></p><p>Microbit LED cathode voltage, all LEDs lit, minimum intensity. x-scale: one square is 5ms.</p><p><img src=images/led_pwm_cathode_all_LED-3-1024x505.png alt></p><p>Microbit LED cathode voltage, all LEDs lit, maximum intensity. x-scale: one square is 5ms.</p><p>I work at sea for half of the year, on a six week on, six week off rota. I first looked at this while I was on a survey ship, with limited test equipment and time as I am paid to do 12 hour shifts, that usually over run. Obviously, the ship would stop operating if Little Matty was not at his station when he is supposed to be.</p><p>I found a voltage supply on the ship, lashed this up to the microbit with a set voltage of 3.00V and measured the current draw through a Fluke multimeter for different numbers of LEDs. What I did not have access to was a &lsquo;scope. So I finished off my investigations when I was back home.</p><p>Looking at the display through a digital camera - I could see that the LED brightness is not constant. The frame rate of the digital camera is not synced with the refresh rate of the display, so as the rows are switched on and off, this is picked up as a variation in intensity in the camera display.</p><p>So even without a &lsquo;scope, I was pretty sure that the rows were being pulsed on and off. Actually, there is a &lsquo;scope on the ship, but as it is connected to the recording equipment to monitor all is well, I figured I should leave it in place.</p><p>Here&rsquo;s my micropython script to turn on/off one LED at a time using the A/B buttons:</p><p># &rsquo;&rsquo;&rsquo; Light LEDs using A and B buttons. &rsquo;&rsquo;&rsquo; from microbit import *</p><p># intensity of LED BRIGHT = &lsquo;9&rsquo; # how many LEDs to turn on at a time INCREMENT = 1 # maximum number of LEDs allowed on at once MAX_BRIGHT = 25 # how many LEDs on at boot START_BRIGHT = 3</p><p>def decrease(num_bright, inc): num_bright = limit(num_bright-inc, MAX_BRIGHT) return num_bright</p><p>def increase(num_bright, inc): num_bright = limit(num_bright+inc, MAX_BRIGHT) return num_bright</p><p>def leds_string2(bright): &rsquo;&rsquo;&rsquo; return led string &rsquo;&rsquo;&rsquo; bright = limit(bright, MAX_BRIGHT) leds_string = BRIGHT*bright + &lsquo;0&rsquo; * (MAX_BRIGHT-bright) leds_string = &ldquo;:".join(leds_string[i:i+5] for i in range(0, len(leds_string), 5)) leds_image = Image(leds_string + &lsquo;:&rsquo;) return leds_image</p><p>def limit(val, limit): &rsquo;&rsquo;&rsquo; limit between 0 and &rsquo;&rsquo;&rsquo; if val > limit: val = 0 if val &lt; 0: val = MAX_BRIGHT return int(val)</p><p>num_bright = START_BRIGHT while True: if button_a.was_pressed(): num_bright = (decrease(num_bright, INCREMENT)) if button_b.was_pressed(): num_bright = (increase(num_bright, INCREMENT)) display.show(leds_string2(num_bright)) sleep(0.1)</p><p><img src=images/experimental_arrangement-1024x766.jpg alt></p><p>Experimental kludge.</p></div><footer class=article-footer><aside class=share><a href="https://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2019%2f03%2fmeasuring-the-bbc-microbit-led-current-draw%2f&title=Measuring%20the%20BBC%20micro%3abit%20LED%20current%20draw" title=はてなブックマーク class=ht target=_blank rel="noopener nofollow">B!</a>
<a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2019%2f03%2fmeasuring-the-bbc-microbit-led-current-draw%2f&text=Measuring%20the%20BBC%20micro%3abit%20LED%20current%20draw&tw_p=tweetbutton" title=Twitterでシェア class=tw target=_blank rel="noopener nofollow"><i class="fab fa-twitter" aria-hidden=true></i></a>
<a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2019%2f03%2fmeasuring-the-bbc-microbit-led-current-draw%2f&t=Measuring%20the%20BBC%20micro%3abit%20LED%20current%20draw" title=Facebookでシェア class=fb target=_blank rel="noopener nofollow"><i class="fab fa-facebook" aria-hidden=true></i></a>
<a href="https://getpocket.com/edit?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2019%2f03%2fmeasuring-the-bbc-microbit-led-current-draw%2f&title=Measuring%20the%20BBC%20micro%3abit%20LED%20current%20draw" title=Pocketに保存 class=pk target=_blank rel="noopener nofollow"><i class="fab fa-get-pocket" aria-hidden=true></i></a>
<a href="https://social-plugins.line.me/lineit/share?url=https%3a%2f%2fmattoppenheim.github.io%2fpost%2f2019%2f03%2fmeasuring-the-bbc-microbit-led-current-draw%2f" title=LINEでシェア class=ln target=_blank rel="noopener nofollow"><i class="fab fa-line" aria-hidden=true></i></a></aside><section class=footer><header><a href=https://mattoppenheim.github.iotags/>TAGS</a></header><ul class=terms><li><a href=https://mattoppenheim.github.iotags/bbb-microbit/>bbb-microbit</a></li><li><a href=https://mattoppenheim.github.iotags/current/>current</a></li><li><a href=https://mattoppenheim.github.iotags/led/>led</a></li><li><a href=https://mattoppenheim.github.iotags/microbit/>microbit</a></li></ul></section></footer></article><div class="adj mrow"><div class="mcol c6"><header>Next Article</header><article class=lism><a href=https://mattoppenheim.github.io/post/2019/03/wordpress-displaying-code-without-or-tags/><div class="thumb thumb-d1b69663bf2d26e63455ffcd39bccdad"></div><div class=inner><div class=title>Wordpress - displaying code without line breaks or paragraph tags</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=7007-03-07T00:00:00JST>Mar 7, 2019</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article></div><div class="mcol c6"><header>Previous Article</header><article class=lism><a href=https://mattoppenheim.github.io/post/2019/01/pytest-and-relative-imports-part-2/><div class="thumb thumb-c02d9cae598b42d922677e8403ca62a7"></div><div class=inner><div class=title>pytest and relative imports part 2</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=16007-01-16T00:00:00JST>Jan 16, 2019</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article></div></div></div><div class="mcol c4"><aside class=l-sidebar><section class=sidebar><header>LATESTS</header><div class="articles sm"><article class=lism><a href=https://mattoppenheim.github.io/post/2022/10/converting-kicad-nightly-build-to-kicad-stable/><div class="thumb thumb-a650b124ce45e26ebb7a65e2357d703b"></div><div class=inner><div class=title>Converting kicad-nightly build to kicad stable</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=12007-10-12T00:00:00JST>Oct 12, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/10/jacdac-using-the-black-magic-programmer/><div class="thumb thumb-055f630d6fb825ab775e5939e6223e0d"></div><div class=inner><div class=title>Jacdac: Using the Black Magic programmer</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=12007-10-12T00:00:00JST>Oct 12, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/05/using-microbits-to-send-data-to-and-from-an-arduino-wirelessly/><div class="thumb thumb-a5214e9b999e197bd08ef76d82293a4f"></div><div class=inner><div class=title>Using micro:bits to send data to and from an Arduino wirelessly</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=10007-05-10T00:00:00JST>May 10, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/05/logic-level-converter-between-an-arduino-and-microbit-using-a-fet-transistor/><div class="thumb thumb-2513cdb6f23eb9ce12686600f4e5e3fe"></div><div class=inner><div class=title>Logic level converter between an Arduino Uno and micro:bit using a FET transistor</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=1007-05-01T00:00:00JST>May 1, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/04/downloading-youtube-videos-using-termux-and-youtube-dl-on-android/><div class="thumb thumb-99946926ea762383b64f3640808c8ef5"></div><div class=inner><div class=title>Downloading YouTube videos using Termux and youtube-dl on Android</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=29007-04-29T00:00:00JST>Apr 29, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/04/kicad-fixing-invisible-gaps-in-board-outlines-on-the-edge-cuts-layer/><div class="thumb thumb-b8a8e92b4bd792ef7ae9e09662b62192"></div><div class=inner><div class=title>Kicad - fixing invisible gaps in board outlines on the Edge.Cuts layer</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=16007-04-16T00:00:00JST>Apr 16, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/04/installing-kicad-nightly-build-on-debian-11/><div class="thumb thumb-0aee508cb6a6c2dcc12e1d5c98ec725a"></div><div class=inner><div class=title>Installing kicad nightly-build on Debian 11</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=8007-04-08T00:00:00JST>Apr 8, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2022/02/remove-spikes-from-a-dataset-using-python/><div class="thumb thumb-0ed92fccd3e6413a138119558128b4af"></div><div class=inner><div class=title>Remove spikes from a dataset using python</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=25007-02-25T00:00:00JST>Feb 25, 2022</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2021/12/bendlabs-single-axis-bend-sensor/><div class="thumb thumb-d204e5f23fe1155f37071ecc587de825"></div><div class=inner><div class=title>Bendlabs single-axis bend sensor</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=30007-12-30T00:00:00JST>Dec 30, 2021</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article><article class=lism><a href=https://mattoppenheim.github.io/post/2021/12/mounting-an-android-phone-on-debian-linux-to-synchronise-files/><div class="thumb thumb-dcfcf5c61d3126c3fa9b237336aa9277"></div><div class=inner><div class=title>Mounting an Android phone on Debian Linux to synchronise files</div><ul class="facts sm"><li><i class="fas fa-calendar" aria-hidden=true></i><time datetime=28007-12-28T00:00:00JST>Dec 28, 2021</time></li><li><i class="fas fa-bookmark" aria-hidden=true></i>POST</li></ul></div></a></article></div></section><section class=sidebar><header>TAGS</header><ul class=terms><li><a href=https://mattoppenheim.github.iotags/microbit>microbit <span class=count>(26)</span></a></li><li><a href=https://mattoppenheim.github.iotags/python>python <span class=count>(16)</span></a></li><li><a href=https://mattoppenheim.github.iotags/microbit-2>microbit-2 <span class=count>(9)</span></a></li><li><a href=https://mattoppenheim.github.iotags/bbc-microbit>bbc-microbit <span class=count>(8)</span></a></li><li><a href=https://mattoppenheim.github.iotags/assistive-technology>assistive-technology <span class=count>(7)</span></a></li><li><a href=https://mattoppenheim.github.iotags/yotta>yotta <span class=count>(7)</span></a></li><li><a href=https://mattoppenheim.github.iotags/linux>linux <span class=count>(6)</span></a></li><li><a href=https://mattoppenheim.github.iotags/micropython>micropython <span class=count>(5)</span></a></li><li><a href=https://mattoppenheim.github.iotags/arduino>arduino <span class=count>(4)</span></a></li><li><a href=https://mattoppenheim.github.iotags/debian>debian <span class=count>(4)</span></a></li></ul></section></aside></div></div></main><footer class=l-footer><div class=l-container><p><span class=h-logo>&copy; mattoppenheim</span></p><aside><p>Powered by <a href=https://gohugo.io/>Hugo</a>.</p><p><a href=https://github.com/dim0627/hugo_theme_robust>Robust</a> designed by <a href=http://yet.unresolved.xyz/>Daisuke Tsuji</a>.</p></aside></div></footer></body></html>